<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nirja & Irfan Reception Seating Chart Search</title>
  <meta name="description" content="Search your name to find your table." />
  <style>
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:#ffffff; background:#000000;
      display:grid; place-items:center; padding:24px;
      min-height:100vh;
      background: radial-gradient(circle at 30% 70%, rgba(100,149,237,0.2), transparent 70%),
                  radial-gradient(circle at 70% 20%, rgba(186,85,211,0.2), transparent 70%),
                  #000000;
      /* changed: allow page to scroll */
      overflow:auto;
      -webkit-overflow-scrolling: touch;
    }

    /* Twinkling stars */
    body::before{
      content:"";
      position:fixed; top:0; left:0; width:100%; height:100%;
      background-image:
        radial-gradient(2px 2px at 20% 30%, #fff, transparent),
        radial-gradient(1.5px 1.5px at 70% 80%, #fff, transparent),
        radial-gradient(1px 1px at 50% 50%, #fff, transparent),
        radial-gradient(2px 2px at 90% 10%, #fff, transparent);
      background-repeat: repeat;
      animation: twinkle 8s linear infinite;
      z-index:0;
      /* new: never intercept scroll/taps */
      pointer-events:none;
    }
    @keyframes twinkle {
      from{opacity:.8} 50%{opacity:.3} to{opacity:.8}
    }

    .wrap{width:100%; max-width:700px; position:relative; z-index:1}
    .card{
      background: rgba(20,20,20,0.85);
      backdrop-filter: blur(6px);
      border:1px solid rgba(255,255,255,0.2);
      border-radius: 20px; padding: 22px; box-shadow: 0 10px 40px rgba(0,0,0,.7);
      text-align:center;
    }
    h1{margin:.4rem 0 .6rem; font-size: clamp(1.6rem, 1.4rem + 2vw, 2.4rem); font-weight:800; color:#fff}
    .instructions{color:#ccc; font-size:.95rem; margin-bottom:10px}
    .search{display:flex; gap:10px; margin:16px 0 10px; align-items:center;}
    .search input{
      flex:1; font-size:1.1rem; padding:14px 16px; border-radius:14px; border:1px solid rgba(255,255,255,.3);
      background:#111; color:#fff; outline: none;
    }
    .search button{cursor:pointer; border:0; border-radius:14px; padding:14px 18px; font-weight:700;
      background: linear-gradient(135deg, #fff, #666); color:#000;
      box-shadow: 0 8px 18px rgba(255,255,255,.25);
    }
    .hint{font-size:.92rem; color:#aaa}
    .result{margin-top:14px; background:#111; border:1px solid rgba(255,255,255,.25); border-radius:16px; padding:14px;}
    .big{font-size: clamp(1.6rem, 1.2rem + 3vw, 3rem); font-weight:800; color:#fff}
    .table-badge{display:inline-grid; place-items:center; padding:14px 18px; border-radius:14px; background:rgba(255,255,255,0.1);
      border:1px solid rgba(255,255,255,.4); color:#fff; font-weight:800; font-size: clamp(1.1rem, 1rem + 1vw, 1.6rem)}
    .list{display:grid; gap:10px; margin-top:8px}
    .row{display:flex; justify-content:space-between; align-items:center; gap:10px; background:#1a1a1a; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.1)}
    .row .nm{font-weight:700; color:#fff}
    .muted{color:#aaa}
    .footer{margin-top:18px; color:#888; font-size:.85rem}
    .logo{max-width:260px; margin:0 auto 20px; display:block}
    .back-btn{margin-top:16px; cursor:pointer; border:0; border-radius:14px; padding:10px 16px; font-weight:600;
      background:#333; color:#fff;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <img src="./logo.png" alt="Wedding Logo" class="logo" />
      <h1>Nirja & Irfan Reception Seating Chart Search</h1>
      <div class="instructions">Enter your name below to find your assigned table. If you don’t see a result, try your full first and last name.</div>

      <div class="search" id="searchBox">
        <input id="q" placeholder="e.g., Nirja Dave" autocomplete="off" />
        <button id="go">Search</button>
      </div>
      <div class="hint">Tip: You can search by first or last name. Accents and case are ignored.</div>

      <div id="out" class="result" hidden></div>
      <button id="backBtn" class="back-btn" hidden>Back to Search</button>

      <div class="footer">Welcome to our reception ✨<br/>Developed by the groom... and obviously ChatGPT</div>
    </div>
  </div>

  <script>
    let DATA = [];

    const norm = (s) => (s||"").toString()
      .normalize('NFD')
      .replace(/\p{Diacritic}/gu, '')
      .replace(/[^\p{L}\p{N}\s\-']/gu, '')
      .trim().toLowerCase();

    function searchGuests(query){
      const qn = norm(query);
      if(!qn) return [];
      const results = DATA.map(g=>({ raw:g, name:g.name, n:norm(g.name) }))
        .map(item=>{
          const parts = item.n.split(/\s+/);
          let score = 3;
          if(item.n === qn) score = 0;
          else if(item.n.startsWith(qn) || parts.some(p=>p.startsWith(qn))) score = 1;
          else if(item.n.includes(qn) || parts.some(p=>qn.includes(p))) score = 2;
          return { ...item, score };
        })
        .filter(x=>x.score<3)
        .sort((a,b)=> a.score - b.score || a.name.localeCompare(b.name, undefined, {sensitivity:'base'}));
      return results.map(r=>r.raw);
    }

    function renderSingle(name, table){
      return `<div class="big">${escapeHtml(name)}</div>
        <div style="height:12px"></div>
        <div class="table-badge">${escapeHtml(table)}</div>`;
    }

    function renderList(list){
      return `<div class="muted">Found ${list.length} matches:</div>
        <div class="list">
          ${list.map(g=>`<div class="row"><div class="nm">${escapeHtml(g.name)}</div><div class="table-badge">${escapeHtml(g.table)}</div></div>`).join('')}
        </div>`;
    }

    function show(html){
      const out = document.getElementById('out');
      out.hidden = false; out.innerHTML = html;
      document.getElementById('backBtn').hidden = false;
    }

    function escapeHtml(s){
      return (s||"").toString().replace(/[&<>\" ]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"," ":"&nbsp;"}[c]));
    }

    async function loadCSV(){
      try {
        const res = await fetch('./guests.csv');
        const text = await res.text();
        const rows = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
        const header = rows[0].toLowerCase();
        const hasHeader = header.includes('name') && header.includes('table');
        const start = hasHeader ? 1 : 0;
        DATA = [];
        for(let i=start;i<rows.length;i++){
          const cells = rows[i].split(',');
          const [name, table] = [cells[0]||'', cells[1]||''];
          if(name && table) DATA.push({ name: name.trim(), table: table.trim() });
        }
      } catch(err){
        console.error('Could not load CSV', err);
      }
    }

    const input = document.getElementById('q');
    const go = document.getElementById('go');
    const backBtn = document.getElementById('backBtn');

    go.addEventListener('click', run);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter') run(); });

    backBtn.addEventListener('click', ()=>{
      document.getElementById('out').hidden = true;
      backBtn.hidden = true;
      input.value = '';
      input.focus();
    });

    function run(){
      const q = input.value;
      const results = searchGuests(q);
      if(!q){ show('<div class="muted">Type your full name, then press Search.</div>'); return; }
      if(results.length===0){
        show(`<div class="muted">No match found for <b>${escapeHtml(q)}</b>.</div>`);
        return;
      }
      if(results.length===1){
        const g = results[0];
        show(renderSingle(g.name, g.table));
      } else {
        show(renderList(results.slice(0,50)));
      }
    }

    loadCSV();
  </script>
</body>
</html>
